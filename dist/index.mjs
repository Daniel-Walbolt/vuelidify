var g=(a,e,t)=>new Promise((i,s)=>{var r=n=>{try{l(t.next(n))}catch(V){s(V)}},d=n=>{try{l(t.throw(n))}catch(V){s(V)}},l=n=>n.done?i(n.value):Promise.resolve(n.value).then(r,d);l((t=t.apply(a,e)).next())});function O(a){let e=0,t;return(...i)=>{var r;let s=++e;return t=(r=t==null?void 0:t.then(()=>{if(e===s)return t=a(...i).then(d=>(t=void 0,d)),t}))!=null?r:a(...i).then(d=>(t=void 0,d)),t}}function I(a,e){let t=0,i;return(...s)=>new Promise(r=>{let d=++t,l=new Date().getTime();i!=null||(i=l-e);let n=l-i-e;n<0?new Promise(V=>setTimeout(V,-1*n)).then(()=>{i=new Date().getTime(),d===t&&r(a(...s)),r(void 0)}):(i=l,r(a(...s)))})}function j(a,e=t=>t){return a.reduce((t,i)=>{if(i!==void 0){let s=e(i);s!==void 0&&t.push(s)}return t},[])}function aa(){return a=>({isValid:a.value!==void 0&&String(a.value).trim().length>0,errorMessage:"This field is required"})}function ea(a){return e=>{var i;let t=String((i=e.value)!=null?i:"");return{isValid:t.length>=a,errorMessage:`Too short (${t.length} / ${a})`}}}function ta(a){return e=>{var i;let t=String((i=e.value)!=null?i:"");return{isValid:t.length<=a,errorMessage:`Too long (${t.length} / ${a})`}}}function ia(a){return e=>({isValid:e.value!==void 0&&e.value>=a,errorMessage:`The minimum value is ${a}`})}function na(a){return e=>({isValid:e.value!==void 0&&e.value<=a,errorMessage:`The maximum value is ${a}`})}function ra(a,e){return t=>({isValid:t.value===a(t),errorMessage:e})}function oa(){return a=>({isValid:a.value?RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/).test(a.value):!1,errorMessage:"Invalid email format"})}import{ref as B,computed as x,watch as W,reactive as q}from"vue";import{computed as Q}from"vue";import{computed as A,reactive as T,ref as b,toValue as J}from"vue";function M(){return`${Date.now()}-${Math.floor(Math.random()*1e3)}`}function k(a,e){let t,i;if(z(e)){let l=$(a,e);t=T(l.validationState),i=[l]}else{let l=L(a,e);t=T(l.state),i=l.validationConfigs}return{propertyState:t,validationConfigs:i}}function S(a,e,t){let i=[],s=r=>`${e?"reactive":"lazy"}-${M()}`;t!=null&&(s=r=>`${t}-${r}`);for(let[r,d]of a.entries())i.push({validatorId:s(r),validator:d,optimized:!1,isReactive:e,previouslyReturnedValidators:!1,previouslySpawnedValidators:{},spawnedValidators:{}});return i}function $(a,e,t=[]){var V,f,u,o;let i=T({isValid:A(()=>{var P,y;let c=(P=n.isLazyValid.value)!=null?P:!1,m=(y=n.isReactiveValid.value)!=null?y:!1;return c&&m}),isValidating:A(()=>n.isValidatingReactive.value||n.isValidatingLazy.value),isErrored:A(()=>i.resultsArray.some(c=>c.isValid===!1)),errorMessages:A(()=>j(i.resultsArray,c=>c.isValid?void 0:c.errorMessage)),results:A(()=>n.namedValidationResults.value),resultsArray:A(()=>n.validationResults.value),arrayState:A(()=>{if(Array.isArray(a.value)===!1||n.elementValidation===void 0)return[];console.time("Array state");let c=a.value,m=n.elementValidation,P=n.arrayConfigMap,y=[],R={},v,w=[];for(let p=0;p<c.length;p++){if(c[p]!==void 0&&typeof c[p]=="object"?(c[p].$ffId===void 0&&Object.defineProperty(c[p],"$ffId",{value:`${n.id}-${n.elementId++}`,writable:!1,configurable:!1,enumerable:!1}),v=c[p].$ffId):c[p]!==void 0&&(v=p),w.push(v),P[v]){y.push(P[v].validationState),R[v]=P[v];continue}if(z(m)){let G=A(()=>c[p]),K=$(G,m,n.arrayParents);P[v]={validationConfigs:[K],validationState:K.validationState}}else{let G=c[p],K=L(G,m,n.arrayParents.concat(G));P[v]={validationConfigs:K.validationConfigs,validationState:K.state}}y.push(P[v].validationState),R[v]=P[v]}return n.arrayConfigMap=R,console.timeEnd("Array state"),y})}),s=!(((f=(V=e.$lazy)==null?void 0:V.length)!=null?f:-1)>0),r=!(((o=(u=e.$reactive)==null?void 0:u.length)!=null?o:-1)>0),d=e.$reactive?S(e.$reactive,!0):[],l=e.$lazy?S(e.$lazy,!1):[],n={id:M(),validationIterationId:0,isReactiveValid:b(r),isValidatingReactive:b(!1),reactiveProcessedValidators:d,isLazyValid:b(s),isValidatingLazy:b(!1),lazyProcessedValidators:l,property:a,validation:e,validationState:i,validationResults:b([]),namedValidationResults:b({}),arrayConfigMap:{},elementId:0,elementValidation:e.$each,arrayParents:T(t)};return n}function L(a,e,t=[]){let i=[],s={};e!==void 0&&r(a,e);function r(d,l){for(let n in l){let V=A(()=>J(d)[n]);if(z(l[n])){let f=l[n],u=$(V,f,t);i.push(u),s[n]=u.validationState}else{let f={},u=l[n];s[n]=f,r(V,u)}}}return{validationConfigs:i,state:s}}function z(a){return(a==null?void 0:a.$reactive)!==void 0||(a==null?void 0:a.$lazy)!==void 0||(a==null?void 0:a.$each)!==void 0}var h=250;function D(a,e,t,i,s){return g(this,null,function*(){let r=!0,d=(V,f,u)=>{if(i!==V.validationIterationId)return;u.isValid===!1&&(r=!1),u.id=f.validatorId;let o=V.validationResults.value.find(c=>c.id===u.id);o!==void 0?(Object.assign(o,u),u.name!==void 0&&V.namedValidationResults[u.name]!==void 0&&Object.assign(V.namedValidationResults.value[u.name],u)):(V.validationResults.value.push(u),u.name!==void 0&&(V.namedValidationResults.value[u.name]=u))},{asyncPromises:l,validatorsWhichPreviouslyReturnedValidators:n}=N(a,e,t,i,s,d,!0,1);if(yield Promise.all(l),i===a.validationIterationId){for(let V of n)for(let f of Object.keys(V.previouslySpawnedValidators))if(V.spawnedValidators[f]==null){let u=a.validationResults.value.findIndex(o=>o.id===f);u!==-1&&a.validationResults.value.splice(u)}}return r})}function N(a,e,t,i,s,r,d,l){let n=a.property.value,V=[],f=[],u=[];for(let o of s){let c=!1;o.previouslyReturnedValidators&&(o.previouslySpawnedValidators=o.spawnedValidators,o.spawnedValidators={},c=!0),o.previouslyReturnedValidators=!1;let m;if(o.computedValidator===void 0){let P={value:n,parent:e,args:t,arrayParents:a.arrayParents};m=o.validator(P)}else m=o.computedValidator.value;if(m instanceof Promise){let P=Date.now();V.push(m.then(y=>g(this,null,function*(){if(y===void 0){c&&u.push(o);return}let R=Date.now()-P;if(d&&R>h&&o.optimized===!1&&(o.optimized=!0,R>h&&R<2*h?o.validator=I(o.validator,h):o.validator=O(o.validator)),Array.isArray(y)){let{asyncPromises:v,syncResults:w}=C(a,e,t,i,r,o,y,l);f.push(...w),yield Promise.all(v);return}else c&&u.push(o);r(a,o,y)})))}else if(Array.isArray(m)){let{asyncPromises:P,syncResults:y}=C(a,e,t,i,r,o,m,l);V.push(...P),f.push(...y)}else if(c&&u.push(o),m!==void 0){if(d&&o.optimized===!1){let P=o.validator;o.computedValidator=Q(()=>{let y={value:a.property.value,parent:e,args:t,arrayParents:a.arrayParents};return P(y)}),o.optimized=!0,o.validator=()=>o.computedValidator.value}f.push(m),r(a,o,m)}}return{asyncPromises:V,syncResults:f,validatorsWhichPreviouslyReturnedValidators:u}}function C(a,e,t,i,s,r,d,l){let n=S(d,r.isReactive,r.validatorId),V=N(a,e,t,i,n,s,!1,++l),f={};for(let u of n)f[u.validatorId]=u;return r.spawnedValidators=f,r.previouslyReturnedValidators=!0,V}function U(a,e,t,i){return g(this,null,function*(){a.isValidatingReactive.value=!0;let s=yield D(a,e,t,i,a.reactiveProcessedValidators);return i===a.validationIterationId&&(a.isReactiveValid.value=s,a.isValidatingReactive.value=!1),a.isReactiveValid.value})}function Z(a,e,t,i){return g(this,null,function*(){a.isValidatingLazy.value=!0;let s=a.lazyProcessedValidators,r=yield D(a,e,t,i,s);return i===a.validationIterationId&&(a.isLazyValid.value=r,a.isValidatingLazy.value=!1),a.isLazyValid.value})}function F(a,e,t,i,s){return g(this,null,function*(){let r=[];for(let d of a){let l=++d.validationIterationId;if(i&&d.validation.$reactive!==void 0&&r.push(yield U(d,e.value,t,l)),s&&d.validation.$lazy!==void 0&&r.push(yield Z(d,e.value,t,l)),d.elementValidation!==void 0){let n=[];for(let V in d.arrayConfigMap)n.push(...d.arrayConfigMap[V].validationConfigs);r.push(yield F(n,e,t,i,s))}}return Promise.all(r).then(d=>d.every(l=>l===!0))})}function H(a){var P;(P=a.delayReactiveValidation)!=null||(a.delayReactiveValidation=!0);let{objectToValidate:e,validation:t,delayReactiveValidation:i,args:s}=a,r=B(!1),d=x(()=>n.some(y=>y.validationState.isValidating)),l=x(()=>n.every(R=>R.isReactiveValid.value&&R.isLazyValid.value)),n=[],V=q({}),f=B(JSON.stringify(a.objectToValidate.value)),u=x(()=>f.value!==JSON.stringify(a.objectToValidate.value)),o=k(e,t);V=o.propertyState,n=o.validationConfigs,W(a.objectToValidate,()=>{i?r.value===!0&&F(n,e,s,!0,!1):F(n,e,s,!0,!1)},{deep:!0});function c(){return g(this,null,function*(){let y=yield F(n,e,s,!0,!0);return r.value=!0,y})}function m(y){f.value=JSON.stringify(y)}return q({hasValidated:r,validate:c,isValidating:d,propertyState:x(()=>V),isValid:l,setReference:m,isDirty:u})}export{O as bufferAsync,oa as isEmailSync,ta as maxLength,na as maxNumber,ea as minLength,ia as minNumber,ra as mustEqual,aa as required,I as throttleQueueAsync,H as useValidation};
